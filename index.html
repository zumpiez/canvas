<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Canvas</title>
        <style>
            #canvas
            {
                border: 1px solid black;
            }
        </style>
        <script src="utils.js"></script>
        <script src="vector2.js"></script>
        <script src="game.js"></script>
        <script src="entity.js"></script>
        <script src="input.js"></script>
        <script>
            // do the inheritance
            utils.inherit(Ball, Entity);
            function Ball(options) {
                options = options || {};
                utils.inherit(this, Entity, options);
                this.radius = options.radius || 2;
                // to update the physics/state of the entity
                this.update = function (gametime) {
                    // do nothing for now
                    return this;
                };
                this.draw = function (context) {
                    context.beginPath();
                    context.arc(this.translation.x, this.translation.y, this.radius,
                        0, Math.PI * 2, false);
                    context.closePath();
                    context.fill();
                    context.stroke();
                    return this;
                };
            }

            // execute on body load
            function load() {
                var canvas, context, game, start, stop, ball, keyboard, frames = 0;

                // set up the keyboard
                keyboard = Input.Keyboard.getInstance();
                utils.on(window, "keyup", keyboard.onKeyup);
                utils.on(window, "keydown", keyboard.onKeydown);

                // find the canvas
                canvas = document.getElementById("canvas");
                // get the drawing context
                context = canvas.getContext("2d");

                // the y axis is inverted (zero is top corner not bottom)
                ball = new Ball({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    radius: 10
                });

                // create the game
                game = new Game({
                    update: function (gametime) {
                        // for the lulz (proof of concept)
                        var key, keys = Input.Keys;
                        for(key in keys){
                            if(keys.hasOwnProperty(key)){
                                if(keyboard.isDown(keys[key])){
                                    console.log("Key [" + key + "] is down");
                                }
                            }
                        }
                        // update that ball!
                        ball.update(gametime);
                    },
                    draw: function () {
                        // calculate the fps
                        var fps = (++frames) / ((+new Date() -
                                this.startTime()) / 1000);
                        // clear (erase) the canvas
                        canvas.width = canvas.width;
                        // draw the fps in text on the canvas
                        context.fillText("fps: " + fps.toFixed(2), 5, 10);
                        // draw that ball!
                        ball.draw(context);
                    }
                });

                start = document.getElementById("start");

                // start click handler
                utils.on(start, "click", function (e) {
                    if (false === game.isRunning()) {
                        frames = 0;
                        utils.log("starting game");
                        game.start();
                    }
                });

                stop = document.getElementById("stop");

                // stop click handler
                utils.on(stop, "click", function (e) {
                    if (true === game.isRunning()) {
                        utils.log("stopping game");
                        game.stop();
                    }
                });
            }
        </script>
    </head>
    <body onload="load()">
        <div class="controls">
            <input id="start" type="button" value="Start" />
            <input id="stop" type="button" value="Stop" />
        </div>
        <div class="game">
            <canvas id="canvas" width="300" height="300">
            </canvas>
        </div>
    </body>
</html>
