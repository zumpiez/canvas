<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Canvas</title>
        <style>
            #canvas
            {
                border: 1px solid black;
            }
        </style>
        <script src="cale.js"></script>
        <script>
            // execute on body load
            function load() {
                var world = new Cale.Entity();

                var graphics = new Cale.Graphics({ canvas: "canvas" });

                var drawComponent = Cale.Component.create({
                    initialize: function () {
                        var self = this;
                        this.parent.subscribe("draw", function () {
                            graphics.clear();
                        });
                    } 
                });

                world.addComponent(drawComponent);
                
                var ball = new Cale.Entity({x:150, y:150});
                Cale.augment(ball, {
                    initialize: function () {
                        var self = this;
                        this.parent.subscribe("update", function (gametime) {
                            self.publish("update", gametime);
                        });
                        this.parent.subscribe("draw", function () {
                            self.publish("draw"); 
                        });
                    }
                });

                var inputComponent = new Cale.InputComponent();
                Cale.augment(inputComponent, {
                    initialize: function () {
                        var self = this;
                        this.parent.subscribe("update", function () {
                            var keyboard = self.keyboard;
                            if (keyboard.isDown(Cale.Input.Keys.LEFT)) {
                                self.parent.translation.x -= 1;
                            } else if (keyboard.isDown(Cale.Input.Keys.RIGHT)) {
                                self.parent.translation.x += 1;
                            }
                            if (keyboard.isDown(Cale.Input.Keys.UP)) {
                                self.parent.translation.y -= 1;
                            } else if (keyboard.isDown(Cale.Input.Keys.DOWN)){
                                self.parent.translation.y += 1;
                            }
                        });
                    }
                });

                var ballDrawComponent = Cale.Component.create({
                    initialize: function () {
                        var self = this;
                        this.parent.subscribe("draw", function () {
                            graphics.arc({
                                x: self.parent.translation.x,
                                y: self.parent.translation.y,
                                radius: 10
                            }).fill();
                        });
                    }
                });

                ball.addComponent(inputComponent);
                ball.addComponent(ballDrawComponent);

                world.addEntity(ball);

                var configuration = {
                    update: function(gameTime) {
                        world.publish("update", gameTime);
                    },
                    draw: function() {
                        world.publish("draw");
                    }
                }
                var game = new Cale.Game(configuration);

                game.start();
            }
        </script>
    </head>
    <body onload="load()">
        <div class="controls">
            <input id="start" type="button" value="Start" />
            <input id="stop" type="button" value="Stop" />
        </div>
        <div class="game">
            <canvas id="canvas" width="300" height="300">
            </canvas>
        </div>
    </body>
</html>
