<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Canvas</title>
        <style>
            #canvas
            {
                border: 1px solid black;
            }
        </style>
        <script src="require.js"></script>
        <script>
            require("cale");
            require("component");
            require("container");
            require("vector2");
            require("entity");
            require("input");
            require("graphics");
            require("game");

            // execute on body load
            function load() {
                var graphics, game, start, stop, ball, keyboard, frames = 0;

                // do the inheritance
                Cale.inherit(Ball, Cale.Entity);
                function Ball(options) {
                    options = options || {};
                    Cale.inherit(this, Cale.Entity, options);
                    this.radius = options.radius || 2;
                    // to update the physics/state of the entity
                    this.update = function (gametime) {
                        // do nothing for now
                        return this;
                    };
                    this.draw = function (graphics) {
                        // draw the arc and fill it
                        graphics.arc({
                            x: this.translation.x,
                            y: this.translation.y,
                            radius: this.radius
                        }).fill();
                        return this;
                    };
                }

                // set up the keyboard
                keyboard = Cale.Input.Keyboard.getInstance();
                Cale.on(window, "keyup", keyboard.onKeyup);
                Cale.on(window, "keydown", keyboard.onKeydown);

                graphics = new Cale.Graphics({ canvas: "canvas" });

                // the y axis is inverted (zero is top not bottom)
                ball = new Ball({
                    x: graphics.width() / 2,
                    y: graphics.height() / 2,
                    radius: 10
                });

                // create the game
                game = new Cale.Game({
                    update: function (gametime) {
                        // for the lulz (proof of concept)
                        Cale.each(Cale.Input.Keys, function(keyCode, key) {
                            if(Cale.Input.Keys.hasOwnProperty(key)){
                                if(keyboard.isDown(Cale.Input.Keys[key])){
                                    Cale.log("Key [" + key + "] is down");
                                }
                            }
                        });
                        // update that ball!
                        ball.update(gametime);
                    },
                    draw: function () {
                        // calculate the fps
                        var fps = (++frames) / ((+new Date() -
                                this.startTime()) / 1000);
                        // clear the screen and draw the fps in text
                        graphics.clear().text({
                            text: "fps: " + fps.toFixed(2),
                            x: 5,
                            y: 10
                        });
                        // draw that ball!
                        ball.draw(graphics);
                    }
                });

                start = document.getElementById("start");

                // start click handler
                Cale.on(start, "click", function (e) {
                    if (false === game.isRunning()) {
                        frames = 0;
                        Cale.log("starting game");
                        game.start();
                    }
                });

                stop = document.getElementById("stop");

                // stop click handler
                Cale.on(stop, "click", function (e) {
                    if (true === game.isRunning()) {
                        Cale.log("stopping game");
                        game.stop();
                    }
                });
            }
        </script>
    </head>
    <body onload="load()">
        <div class="controls">
            <input id="start" type="button" value="Start" />
            <input id="stop" type="button" value="Stop" />
        </div>
        <div class="game">
            <canvas id="canvas" width="300" height="300">
            </canvas>
        </div>
    </body>
</html>
