<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Canvas</title>
        <style>
            #canvas
            {
                border: 1px solid black;
            }
        </style>
        <script src="cale.js"></script>
        <script>
            var gameConsole;

            function load() {
                var graphics, frames;

                var world = new Cale.Entity();

                var drawWorldComponent = Cale.Component.create({
                    initialize: function () {
                        this.subscribe("draw", function (graphics) {
                            graphics.clear().save();
                            frames += 1;
                            this.publish("camera.draw", graphics);
                            graphics.restore();
                        });
                    }
                });

                world.addComponent(drawWorldComponent);

                gameConsole = Cale.Component.create({
                    showFps: true,
                    initialize: function () {
                        this.subscribe("draw", function (graphics) {
                            var offsetY = 10;
                            if (this.showFps === true) {
                                graphics.text({
                                    text: "fps: " + this.fps().toFixed(2),
                                    x: 5,
                                    y: offsetY
                                });
                                offsetY += 5;
                            }
                        });
                    },
                    fps: function () {
                        return ++frames / ((+new Date() -
                            game.startTime()) / 1000);
                    }
                });

                world.addComponent(gameConsole);

                var game = new Cale.Game({
                    update: function (gametime) {
                        world.publish("update", gametime);
                    },
                    draw: function () {
                        graphics = graphics || new Cale.Graphics("canvas");
                        world.publish("draw", graphics);
                    }
                });

                Cale.on("start", "click", function () {
                    frames = 0;
                    game.start();
                });

                Cale.on("stop", "click", function () {
                    game.stop();
                });
            }
        </script>
    </head>
    <body onload="load()">
        <div class="controls">
            <input id="start" type="button" value="Start" />
            <input id="stop" type="button" value="Stop" />
        </div>
        <div class="game">
            <canvas id="canvas" width="300" height="300">
            </canvas>
        </div>
    </body>
</html>
